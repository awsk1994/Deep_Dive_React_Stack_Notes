# 1. 初入 React 世界

## 1.1 React简介

 - 是Facebook在2013年开源在 GitHub 上的 JavaScript 库。
 - React 把用户界面抽象成**一个个组件**
 - 开发者通过**组合**这些组件， 最终得到功能丰富、可交互的页面
 - 通过引入 JSX 语法，复用组件变得非常容易，同时也能保证组件结构清晰
 - 可搭配 Flux、Redux、GraphQL/Relay 

### 1.1.2 Virtual DOM
 - 真是页面对应着一个DOM，但DOM操作很昂贵，因此React 把真实 DOM 树转换成 JavaScript 对象树，也 就是 Virtual DOM。
 - 每次数据更新后，重新计算Virtual DOM，并和上一次生成的 Virtual DOM 做对比，对发生 变化的部分做批量更新。
 - 因为使用了Virtual DOM，React也可以和其他平台集成
   - 比如：React-Native是基于Virtual DOM来渲染出app的
   - 因此，React的口号是：*Learn once, Write anywhere*

## 1.2 JSX语法

 - React是通过创建与更新虚拟元素（virtual element）来管理整个VirtualDOM的。
 - 虚拟元素可以理解为正式元素的对应
   - 他的结构与更新都是在内存中完成的，并不会渲染到DOM中去
 - React可创建的虚拟元素可分成两类：
   - DOM元素（DOM Element）
     - 原生DOM元素
   - 组件元素（component element）
     - 自定义元素

### a）DOM元素

 - 如果用HTML表示一个Button：
```html
<button class="btn btn-blue">
  <em>Confirm</em>
</button>
```

 - 如果转换成JSON对象，就会是：
```json
{
  type: 'button',
  props: {
    className: 'btn btn-blue',
    children: [{
      type: 'em',
      props: {
        children: 'Confirm
      }
    }]
  }
}
```

 - 这样，我们可以在javascript中创建VirtualDOM元素了
 - *注意：这些元素并不是真实的实例，只是想表达一个概念！*

### b）组件元素

 - 我们也可以把Button写成一个公共方法：

```js
const Button = ({color, text}) => {
  return {
    type: 'button',
    props: {
      className: 'btn btn-${color}',
      children: {
        type: 'em',
        props: {
          children: text
        }
      }
    }
  }
}
```

 - 我们调用`Button({color: 'blue', text: 'Confirm'})`就可以创建Button了
 - 因为有公共方法，我们就可以让元素彼此嵌套或混合，建出完整的DOM树：
```js
const DangerButton = ({text}) => ({
  type: Button,
  props: {
    color: 'red',
    children: text
  }
})

const DeleteAccount = () => ({
  type: 'div',
  props: {
    children: [{
      type: 'p',
      props: {
        children: 'Are you sure?'
      }
    }, {
      type: DangerButton,
      props: {
        children: 'Confirm'
      }
    }, {
      type: Button,
      props: {
        color: 'blue',
        children: 'Cancel'
      }
    }]
  }
})
```

 - *注意：这些元素并不是真实的实例，只是想表达一个概念！*

 - 现在都是使用Babel的JSX编译器转换JSX到HTML，比如：

```js
var DeleteAccount = function DeleteAccount(){
  return React.createElement(
    'div',
    null,
    React.createElement(
      'p',
      null,
      'Are you sure?'
    ),
    React.createElement(
      DangerButton,
      null,
      'Confirm'
    ),
    React.createElement(
      Button,
      {color: 'blue'},
      'Cancel'
    )
  )
}
```

 - 除了`React.createElement`之外，结构跟之前的都一样
 - 其实JSX并不是强制选项，但是JSX更易与阅读与开发，因此建议使用

### 1.2.2 JSX基本语法

#### 1.2.2(1) XML基本语法

#### 1.2.2(2) 元素类型

 - **小写**首字母对应DOM元素、**大写**首字母对应组件元素。
 - 为了解决**组件相同名称冲突**的问题，JSX还可以通过**命名空间的方式**使用组件元素
   - 另一个好处是可以**对一组组件进行归类**
   - 比如，我们想使用 Material UI 组件库中的组件，以 MUI 为包名，可以这么写:

```js
const App = () => (
  <MUI.RaisedButton label="Default" />
);
```

**注解**

 - 在HTML中，注解写成`<!--content-->`，在JSX：
   - 在一个组件的子元素位置使用注解要用`{}`包起来
   - 其他情况，可用`/*...*/`

```js
ReactDOM.render(
    /* 这是正确的注释 */
    <div>
    /* 这是错误的注释 */
    {/* 这是正确的注释 */}
        <p>{/* 这是正确的注释 */}</p>
    </div>,
    document.getElementById('demo')
);
```

**条件注释**

 - HTML中使用：
```html
<!--[if IE]>
  <p>Work in IE browser</p>
<![endif]-->
```

 - JavaScript就是：
```js
{
  (!!window.ActiveXObject || 'ActiveXObject' in window) ? <p>Work in IE browser</p> : '' 
}
```

#### 1.2.2(3) 元素属性

**标签的属性**

 - 无论是DOM元素或组件元素都有属性
 - JSX的**DOM元素**的属性跟html的都一样，但有两个例外：
   - [HTML] class -> [JSX] className
   - [HTML] for -> [JSX] htmlFor

```jsx
/* 这是jsx */

{/*html class属性*/}
<div className="myClass"></div>

{/*html label标签 */}
<label htmlFor="name" class="mayName"></label>
```

 - 而**组件元素**的属性是完全**自己定义**的，也可以理解为实现组件所需要的参数，比如：

```js
const Header = ({title, children}) => (
  <h3 title={title}>{children}</h3>
);
...
<Header title="hello world">Hello world</Header>
```

**Boolean 属性**
 - 忽略**Boolean属性值**会导致JSX认为bool值设为了True。
 - 传达False就一定要使用表达式

```jsx
/* 以下两个意义相同 */
<Checkbox checked={true}/>
<Checkbox checked/>

/* 传达False需要表达式 */
<Checkbox checked={false}/>
```

**展开属性**

 - 如果事先知道组件需要的属性，可写为：
 ```js
 const component = <Component name={name} value={value} />;
```

 - 如果不知道设置什么好，可以写为：
```js
const component = <Component />; 
component.props.name = name; 
component.props.value = value;
```

 - 但是，React不能帮你检查属性类型（propTypes），所以这样的写法不建议。
 - 可以考虑使用 ES6 rest/spread 特性来提高效率: 
 
```js
const data = { name: 'foo', value: 'bar' };
const component = <Component name={data.name} value={data.value} />;
```

 - 或，也可以写成:
 ```js
const data = { name: 'foo', value: 'bar' }; 
const component = <Component {...data} />;
```

**自定义 HTML 属性**

 - (SKIPPED)

#### 1.2.2(4) JavaScript属性表达式 
 - 属性值可以用表达式，ba {} 替换 "" 即可:
```js
const person = <Person name={window.isLoggedIn ? window.name : ''} />;
```

 - 子组件也可以作为表达式使用:
```js
const content = <Container>{window.isLoggedIn ? <Nav /> : <Login />}</Container>;
```

#### 1.2.2(5) HTML转义

 - React会将所有要显示到DOM的字符串转义，防止XSS。 
 - 所以，如果JSX中含有转义后的实体字符，比如 &copy;(转义后是©)，则最后 DOM 中不会正确显示，因为 React 自动把 &copy; 中的特 殊字符转义了。有几种解决办法:
   - 直接使用UTF-8字符：`<div>版权 ©</div>`
   - 使用对应字符的 Unicode 编码查询编码;`{'版权 \u00a9'}`
   - 直接插入原始的 HTML。`<div>版权 &#169;</div>`
   - 使用数组组装`<div>{['cc ', <span>&copy;</span>, ' 2015']}</div>`; 
   - 或者十进制的转义字符



